print((lambda grid, f, s, seen = set(), a = []: (lambda seq: (lambda i: s(seq[(1000000000 - i) % (len(seq) - i) + i - 1]))(seq.index(a[-1]) + 1))([a.append(grid), [[seen.add(g), a.append(f(g)), a[-1]][-1] for g in a if g not in seen]][-1]))(tuple(open(0).read().splitlines()), (lambda f: lambda grid: f(f(f(f(grid)))))(lambda grid: tuple("#".join("".join(sorted(segment, reverse=True)) for segment in line.split("#"))[::-1] for line in map("".join, zip(*grid)))), lambda grid: sum(i * row.count("O") for i, row in enumerate(grid[::-1], 1))))
