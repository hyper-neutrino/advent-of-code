print((lambda re, s, _, *m: (lambda n: (lambda math, o: [o.__setitem__(0, o[0] * k // math.gcd(o[0], k)) for k in o[1:]] and o[0])(__import__("math"), [(lambda a: len([0 if p[-1] == "Z" else a.append(n[p][s[(len(a) - 1) % len(s)] == "R"]) for p in a]) - 1)([q]) for q in n if q[-1] == "A"]))(dict((a, (b, c)) for a, b, c in [re.findall("\\w{3}", k) for k in m])))(__import__("re"), *open(0).read().splitlines()))
